
name: deploy-page

# Trigger the workflow on push events
# This ensures the documentation is automatically updated whenever code changes are pushed
on:
  push:
    branches:
      - main

jobs:
  # Job to test exporting only notebooks (no apps)
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Step 1: Checkout the repository code
      - name: Checkout ${{ github.repository }}
        uses: actions/checkout@v4

      # Step 2: Test the export action with only notebooks (no apps)
      - name: "Build the virtual environment for ${{ github.repository }}"
        uses: ./actions/export
        with:
          # Only specify the notebooks folder, leave apps empty to test that scenario
          notebooks: 'src/tests/resources/notebooks'
          apps: 'src/tests/resources/apps'
          notebooks_wasm: 'src/tests/resources/notebooks_wasm'

  deploy:
    runs-on: ubuntu-latest
    needs: build
    permissions:
      id-token: write
      pages: write

    environment:
      name: github-pages

    steps:
      # Download all artifacts from previous jobs
      # This collects the outputs from both the jupyter and marimo jobs
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: book

      - name: Inspect artifacts folder
        shell: bash
        run: |
          tree book

        # Package all artifacts for GitHub Pages deployment
        # This prepares the combined outputs for deployment
      - name: Upload static files as artifact
        id: upload
        uses: actions/upload-pages-artifact@v3 # or specific "vX.X.X" version tag for this action
        with:
          path: book/  # Path to the directory containing all artifacts

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
